var po=org.polymaps,map=po.map().container(document.getElementById("map").appendChild(po.svg("svg"))).center({lat:37.787,lon:-122.228}).zoom(14).zoomRange([12,16]).add(po.interact());map.add(po.image().url(po.url("http://{S}tile.cloudmade.com/1a1b06b230af4efdbb989ea99e9841af/20760/256/{Z}/{X}/{Y}.png").hosts(["a.","b.","c.",""])));map.add(po.geoJson().url(crimespotting("http://oakland.crimespotting.org/crime-data?count=1000&format=json&bbox={B}&dstart=2010-04-01&dend=2010-05-01")).on("load",load).clip(false).zoom(14));
map.add(po.compass().pan("none"));function crimespotting(c){return function(a){var d=1<<a.zoom,b=a.column%d;if(b<0)b+=d;return c.replace(/{(.)}/g,function(f,e){switch(e){case "B":var g=map.coordinateLocation({row:a.row,column:b,zoom:a.zoom}),h=map.coordinateLocation({row:a.row+1,column:b+1,zoom:a.zoom}),i=Math.ceil(Math.log(a.zoom)/Math.LN2);return g.lon.toFixed(i)+","+h.lat.toFixed(i)+","+h.lon.toFixed(i)+","+g.lat.toFixed(i)}return e})}}
function load(c){for(var a=c.tile.cluster||(c.tile.cluster=kmeans().iterations(16).size(64)),d=0;d<c.features.length;d++){var b=c.features[d];a.add({x:Number(b.element.getAttribute("cx")),y:Number(b.element.getAttribute("cy"))})}c=c.tile;for(b=c.element;b.lastChild;)b.removeChild(b.lastChild);a=a.means();a.sort(function(g,h){return h.size-g.size});for(d=0;d<a.length;d++){var f=a[d],e=b.appendChild(po.svg("circle"));e.setAttribute("cx",f.x);e.setAttribute("cy",f.y);e.setAttribute("r",Math.pow(2,c.zoom-
11)*Math.sqrt(f.size))}};
